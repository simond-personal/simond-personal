const logger=window.console?window.console:{log:()=>{}};let __iframeSizeCode,__rootIframeContainer,__methodIframeContainer,__challengeIframeContainer;const IN_TEST_MODE=!1,THREEDS_METHOD_TIMEOUT=1e4,threedsSDK={},challengeWindowMap=new Map;challengeWindowMap.set('01',['250px','400px']),challengeWindowMap.set('02',['390px','400px']),challengeWindowMap.set('03',['500px','600px']),challengeWindowMap.set('04',['600px','400px']),challengeWindowMap.set('05',['100%','100%']),threedsSDK.get3DSMethodStatus=(a,b,c,d)=>{__rootIframeContainer=document.body,logger.log('### threedsSDK::get3DSMethodStatus:: __rootIframeContainer=',__rootIframeContainer),d&&('object'==typeof d?__rootIframeContainer=d.jquery?d[0]:d:'string'==typeof d&&(__rootIframeContainer=document.querySelector(d))),logger.log('### threedsSDK::get3DSMethodStatus:: __rootIframeContainer2=',__rootIframeContainer);const f={threeDSCompInd:'U'},g=new Promise(function(h,i){if(!b||!b.length)h(f);else{const k=JSON.stringify({threeDSServerTransID:a,threeDSMethodNotificationURL:c}),l=base64urlEncode(k),m='0',n='0',o=`<iframe name="threeDSMethodIframe" src="" class="js-iframe-threedsmethod" frameborder="0" scrolling="no" allowtransparency="true" style="border: none; height: ${n}; width: ${m}; background-color: #b3712c;"><p>Your browser does not support iframes.</p></iframe>`;let q,r,s,t,u=!1;if(__methodIframeContainer=document.createElement('div'),__methodIframeContainer.setAttribute('id','methodIframeContainer'),__rootIframeContainer.appendChild(__methodIframeContainer),__methodIframeContainer.innerHTML=o,q=document.body.querySelector('.js-iframe-threedsmethod'),q){const v=createForm('threedsMethodForm',b,'threeDSMethodIframe','threeDSMethodData',l);__rootIframeContainer.appendChild(v),v.submit(),setTimeout(function(){__rootIframeContainer.removeChild(v)},1e3)}q&&(r=q.contentWindow,s=setInterval(function(){if(!u)try{r.location&&r.location.host&&(r.location.host===window.location.host&&(logger.log('\n### threedsSDK::HOME!!:: iframeContent.location.host=',r.location.host),logger.log('### threedsSDK::HOME!!:: iframeContent.location=',r.location),logger.log('### threedsSDK::HOME!!:: params',parseQueryString(r.location.search))),clearInterval(s),clearTimeout(t),logger.log('### threedsSDK:: 3DSMethodURL call Completed Successfully:: '),cleanup3DSMethod('3DS Method success:'),f.threeDSCompInd='Y',h(f))}catch(v){}},100)),t=setTimeout(()=>{u=!0,clearInterval(s),logger.log('### threedsSDK::3DSMethodURL call:: Timeout'),cleanup3DSMethod('3DS Method Timeout'),f.threeDSCompInd='N',i(f)},THREEDS_METHOD_TIMEOUT)}});return g},threedsSDK.doChallenge=(a,b,c)=>{__iframeSizeCode=c&&c.size?c.size:'01';const d=challengeWindowMap.get(__iframeSizeCode);let f,g=!1,h='threeDSIframe';if(c&&c.container){const l=c.container;switch(typeof l){case'object':let m=l.jquery?l[0]:l;m instanceof HTMLIFrameElement?(logger.log('### threedsSDK::doChallenge:: IS iframe'),h=m.getAttribute('name'),f=m,g=!0,logger.log('### threedsSDK::doChallenge:: iframe name=',h)):__rootIframeContainer=m;break;case'string':__rootIframeContainer=document.querySelector(l);}logger.log('### threedsSDK::doChallenge:: __rootIframeContainer=',__rootIframeContainer)}b.challengeWindowSize=__iframeSizeCode,logger.log('### threedsSDK::doChallenge:: cReqData=',b);const i=JSON.stringify(b),j=base64urlEncode(i);logger.log('### threedsSDK::doChallenge:: base64urlEncodedData=',j);const k=new Promise(function(l,m){if(!g){const o=`<iframe name="${h}" src="${''}" class="js-iframe-acsui" frameborder="0" scrolling="no" allowtransparency="true" style="border: none; width: ${d[0]}; height: ${d[1]}; background-color: #f7f7f7;"><p>Your browser does not support iframes.</p></iframe>`;__challengeIframeContainer=document.createElement('div'),__challengeIframeContainer.setAttribute('id','challengeIframeContainer'),__rootIframeContainer.appendChild(__challengeIframeContainer),__challengeIframeContainer.innerHTML=o,__challengeIframeContainer.style.position='absolute',__challengeIframeContainer.style.width='100%',__challengeIframeContainer.style.height='100%',f=document.body.querySelector('.js-iframe-acsui')}if(f){const n=createForm('cReqForm',a,h,'creq',j);__rootIframeContainer.appendChild(n),n.submit(),setTimeout(function(){__rootIframeContainer.removeChild(n)},1e3)}if(f){const n=f.contentWindow;let o=setInterval(function(){try{if(n.location&&n.location.host){n.location.host===window.location.host&&(logger.log('\n### threedsSDK::HOME!!:: frameContent.location.host=',n.location.host),logger.log('### threedsSDK::HOME!!:: frameContent.location=',n.location),logger.log('### threedsSDK::HOME!!:: params',parseQueryString(n.location.search)));let q=parseQueryString(n.location.search).transStatus;if(q){let r=parseQueryString(n.location.search).threeDSServerTransID;if(clearInterval(o),'y'===q.toLowerCase())return logger.log('### threedsSDK:: Challenge Completed Successfully:: '),g||cleanupChallenge('Challenge success'),void l({transStatus:'Y',threeDSServerTransID:r});if('n'===q.toLowerCase())return logger.log('### threedsSDK:: Challenge was rejected '),g||cleanupChallenge('Challenge fail'),void m({transStatus:'N',threeDSServerTransID:r})}}}catch(q){}},100)}});return k};const cleanup3DSMethod=()=>{__methodIframeContainer.innerHTML='',__rootIframeContainer.removeChild(__methodIframeContainer)},cleanupChallenge=()=>{__challengeIframeContainer.innerHTML='',__rootIframeContainer.removeChild(__challengeIframeContainer)},createForm=(a,b,c,d,f)=>{const g=document.createElement('form');g.style.display='none',g.name=a,g.action=b,g.method=-1<b.indexOf('sponglord.github')?'GET':'POST',g.target=c;const h=document.createElement('input');return h.name=d,h.value=f,g.appendChild(h),g},wait=a=>new Promise(b=>setTimeout(b,a)),base64urlEncode=a=>{let b=window.btoa(a),c=b.split('=')[0];return c=c.replace('/+/','-'),c=c.replace('///','_'),c},base64urlDecode=a=>{let b=a;switch(b=b.replace('/-/','+'),b=b.replace('/_/','/'),b.length%4){case 0:break;case 2:b+='==';break;case 3:b+='=';break;default:logger.log('### threedsSDK::base64urlDecode:: Illegal base64url string!');}let c=window.atob(b);return c},parseQueryString=a=>{const b={};if(!a||!isString(a))return b;'?'===a.substring(0,1)&&(a=a.substring(1));for(const c=a.split('&');0<c.length;){const d=c.shift().split('='),f=d.shift(),g=d.join('=');f&&g&&(b[decodeURIComponent(f)]=decodeURIComponent(g))}return b},objToString=Object.prototype.toString;function isString(a){return'string'==typeof a||isObjectLike(a)&&objToString.call(a)==='[object String]'}function isObjectLike(a){return!!a&&'object'==typeof a}export default threedsSDK;